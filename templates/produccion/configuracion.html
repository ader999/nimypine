<!-- produccion/templates/produccion/configuracion.html -->
{% extends 'produccion/base_produccion.html' %}

{% block title %}Configuración{% endblock %}

{% block page_title %}Configuración de la Aplicación{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Opciones de Configuración</h5>
            </div>
            <div class="card-body">
                <!-- Configuración de Perfil de Usuario -->
                <div class="mb-4">
                    <h6 class="text-primary"><i class="bi bi-person-circle me-2"></i>Perfil de Usuario</h6>
                    <p class="text-muted small">Gestiona tu información personal y preferencias de cuenta.</p>
                    <ul class="list-unstyled">
                        <li><a href="{% url 'produccion:cambiar_contrasena' %}" class="text-decoration-none">Cambiar contraseña</a></li>
                        <li><a href="{% url 'produccion:actualizar_perfil' %}" class="text-decoration-none">Actualizar información de contacto</a></li>
                        <li><a href="{% url 'produccion:configurar_avatar' %}" class="text-decoration-none">Configurar avatar</a></li>
                    </ul>
                </div>

                <!-- Configuración de Empresa -->
                <div class="mb-4">
                    <h6 class="text-primary"><i class="bi bi-building me-2"></i>Empresa (MiPyme)</h6>
                    <p class="text-muted small">Ajusta los detalles de tu empresa y preferencias generales.</p>
                    <ul class="list-unstyled">
                        <li><a href="{% url 'produccion:editar_informacion_empresa' %}" class="text-decoration-none">Editar información de la empresa</a></li>
                        <li><a href="{% url 'produccion:configurar_logo' %}" class="text-decoration-none">Configurar logo</a></li>
                        <li><a href="{% url 'produccion:cambiar_sector_economico' %}" class="text-decoration-none">Cambiar sector económico</a></li>
                    </ul>
                </div>

                <!-- Configuración de Producción -->
                <div class="mb-4">
                    <h6 class="text-primary"><i class="bi bi-gear-wide-connected me-2"></i>Producción</h6>
                    <p class="text-muted small">Personaliza parámetros relacionados con la producción y costos.</p>
                    <ul class="list-unstyled">
                        <li><a href="{% url 'produccion:configurar_parametros_produccion' %}" class="text-decoration-none">Configurar parámetros de producción</a></li>
                    </ul>
                </div>

                <!-- Configuración de Tienda Online -->
                <div class="mb-4">
                    <h6 class="text-primary"><i class="bi bi-shop me-2"></i>Tienda Online</h6>
                    <p class="text-muted small">Gestiona la visibilidad de tus productos en la tienda pública.</p>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="tiendaVisibleSwitch" {% if request.user.mipyme.tienda_visible %}checked{% endif %}>
                        <label class="form-check-label" for="tiendaVisibleSwitch">Mostrar mis productos en la tienda</label>
                    </div>
                    <div id="tiendaSwitchStatus" class="small mt-1"></div>
                </div>

                <script>
                    $(document).ready(function() {
                        $('#tiendaVisibleSwitch').change(function() {
                            var isChecked = $(this).is(':checked');
                            var statusDiv = $('#tiendaSwitchStatus');
                            
                            statusDiv.text('Actualizando...').removeClass('text-success text-danger');
                            $(this).prop('disabled', true); // Disable while updating

                            $.ajax({
                                url: "{% url 'produccion_api:toggle_store_visibility' %}",
                                type: "POST",
                                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                                success: function(response) {
                                    if (response.status === 'success') {
                                        statusDiv.text(response.message).addClass('text-success');
                                        // Update switch state based on server response just in case
                                        $('#tiendaVisibleSwitch').prop('checked', response.tienda_visible);
                                    } else {
                                        statusDiv.text('Error: ' + response.message).addClass('text-danger');
                                        // Revert switch if error
                                        $('#tiendaVisibleSwitch').prop('checked', !isChecked);
                                    }
                                },
                                error: function(xhr, status, error) {
                                    statusDiv.text('Error de conexión. Inténtalo de nuevo.').addClass('text-danger');
                                    // Revert switch if error
                                    $('#tiendaVisibleSwitch').prop('checked', !isChecked);
                                },
                                complete: function() {
                                    $('#tiendaVisibleSwitch').prop('disabled', false); // Re-enable
                                }
                            });
                        });
                    });
                </script>

                <!-- Configuración de Notificaciones 
                <div class="mb-4">
                    <h6 class="text-primary"><i class="bi bi-bell me-2"></i>Notificaciones</h6>
                    <p class="text-muted small">Controla cómo y cuándo recibir notificaciones.</p>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-decoration-none">Alertas de stock bajo</a></li>
                        <li><a href="#" class="text-decoration-none">Notificaciones de ventas</a></li>
                        <li><a href="#" class="text-decoration-none">Recordatorios de producción</a></li>
                    </ul>
                </div>

               

                <div class="mb-4">
                    <h6 class="text-primary"><i class="bi bi-shield-check me-2"></i>Seguridad</h6>
                    <p class="text-muted small">Gestiona la seguridad de tu cuenta y datos.</p>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-decoration-none">Autenticación de dos factores</a></li>
                        <li><a href="#" class="text-decoration-none">Sesiones activas</a></li>
                        <li><a href="#" class="text-decoration-none">Historial de acceso</a></li>
                    </ul>
                </div> -->
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header">
                <h6 class="mb-0">Información del Sistema</h6>
            </div>
            <div class="card-body">
                <p><strong>Usuario:</strong> {{ request.user.username }}</p>
                <p><strong>Empresa:</strong> {{ nombrepine }}</p>
                <p><strong>Versión:</strong> 1.0.0</p>
                <p><strong>Última actualización:</strong> {{ request.user.last_login|date:"d/m/Y H:i" }}</p>
            </div>
        </div>

        <div class="card shadow-sm mt-3">
            <div class="card-header">
                <h6 class="mb-0">Acciones Rápidas</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'produccion:panel' %}" class="btn btn-outline-primary">
                        <i class="bi bi-arrow-left me-2"></i>Volver al Panel
                    </a>
                    <form method="post" action="{% url 'cuentas:logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-danger w-100">
                            <i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}