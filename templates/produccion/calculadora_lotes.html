<!-- produccion/templates/produccion/calculadora_lotes.html -->
{% extends 'produccion/base_produccion.html' %}

{% block title %}Calculadora de Lotes - {{ producto.nombre }}{% endblock %}

{% block page_title %}Calculadora de Lotes para {{ producto.nombre }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Información del Producto</h5>
            </div>
            <div class="card-body">
                <p><strong>Costo por Unidad:</strong> ${{ producto.costo_de_produccion|floatformat:2 }}</p>
                <p><strong>Precio de Venta:</strong> ${{ producto.precio_venta|floatformat:2 }}</p>
                <p><strong>Margen por Unidad:</strong> ${{ producto.margen_de_ganancia|floatformat:2 }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Ingresar Cantidad de Unidades</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="{{ form.cantidad_unidades.id_for_label }}" class="form-label">{{ form.cantidad_unidades.label }}</label>
                        {{ form.cantidad_unidades }}
                    </div>
                    <button type="submit" class="btn btn-primary">Calcular Lote</button>
                </form>
            </div>
        </div>
    </div>

    {% if resultados %}
    <div class="col-md-6">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Resultados del Cálculo</h5>
            </div>
            <div class="card-body">
                <h6>Insumos Requeridos</h6>
                <div class="table-responsive">
                    <table class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Insumo</th>
                                <th>Cantidad Total</th>
                                <th>Costo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in resultados %}
                            <tr>
                                <td>{{ item.insumo }}</td>
                                <td>{{ item.cantidad_total|floatformat:2 }} {{ item.unidad }}</td>
                                <td>${{ item.costo|floatformat:2 }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="2">Costo Total Insumos</th>
                                <th>${{ costo_total_insumos|floatformat:2 }}</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <h6 class="mt-3">Costos de Procesos</h6>
                <p><strong>Costo Total Procesos:</strong> ${{ costo_total_procesos|floatformat:2 }}</p>

                <h6 class="mt-3">Resumen del Lote</h6>
                <p><strong>Costo Total del Lote:</strong> ${{ costo_total|floatformat:2 }}</p>
                <p><strong>Ingresos Estimados:</strong> ${{ ingresos_estimados|floatformat:2 }}</p>
                <p><strong>Ganancia Estimada:</strong> ${{ ganancia_estimada|floatformat:2 }}</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<div class="mt-4">
    <a href="{% url 'produccion:detalle_producto' producto.id %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left-circle me-1"></i> Volver al Detalle del Producto
    </a>
</div>
{% endblock %}